<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Part 2</title>
    <link rel="icon" type="image/x-icon" href="../icon.png">
    <style>
        section {
            display: flex;
        }
        article {
            margin: 10px;
            padding: 10px;
            min-width: 300px;
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <header>
        <h1>Ryan's Travel Log</h1>
    </header>
    <main>

    </main>
    <script>
        const main = document.querySelector('main');
        //The displayCityInfo() function from week 11, modified to display all cities
        function DisplayTravelLog(travelLog) {
            const travelLogSection = travelLog.reduce((accumulator, currentVal) => {
                const city = document.createElement('article');
                //City name
                const cityNameH2 = document.createElement('h2');
                const cityName = document.createTextNode(currentVal['cityName']);
                cityNameH2.appendChild(cityName);
                city.appendChild(cityNameH2);
                const hr = document.createElement('hr');
                city.appendChild(hr);
                //Attractions
                const attractionsH3 = document.createElement('h3');
                const attractionsH3Text = document.createTextNode("Attractions");
                attractionsH3.appendChild(attractionsH3Text);
                city.appendChild(attractionsH3);
                const attractionsUl = currentVal['attractions'].reduce((accumulator, currentVal) => {
                    const attractionLi = document.createElement('li');
                    const attractionName = document.createTextNode(currentVal);
                    attractionLi.appendChild(attractionName);
                    accumulator.appendChild(attractionLi);
                    return accumulator;
                }, document.createElement('ul'));
                city.appendChild(attractionsUl);
                //Weather
                const weatherH3 = document.createElement('h3');
                const weatherH3Text = document.createTextNode("Weather");
                weatherH3.appendChild(weatherH3Text);
                city.appendChild(weatherH3);
                const weatherUl = currentVal['weather'].reduce((accumulator, currentVal) => {
                    const weatherLi = document.createElement('li');
                    const weather = document.createTextNode(`${currentVal['season']}: ${currentVal['typicalCondition']}`);
                    weatherLi.appendChild(weather);
                    accumulator.appendChild(weatherLi);
                    return accumulator;
                }, document.createElement('ul'));
                city.appendChild(weatherUl);
                //Visited
                const visitedP = document.createElement('p');
                if (currentVal['visited']) {
                    const visited = document.createTextNode(`I have visited ${currentVal['cityName']}`);
                    visitedP.appendChild(visited);
                } else {
                    const visited = document.createTextNode(`I have not visited ${currentVal['cityName']} yet`);
                    visitedP.appendChild(visited);
                }
                city.appendChild(visitedP);
                accumulator.appendChild(city);
                return accumulator
            }, document.createElement('section'));
            //Clear main of all loading messages
            main.innerHTML = '';
            main.appendChild(travelLogSection);
        }

        //Function to fetch a JSON file and return it as a promise
        function fetchJSON(file) {
            const loadingP = document.createElement('p');
            const loadingText = document.createTextNode(`Loading '${file}'`);
            loadingP.appendChild(loadingText);
            main.appendChild(loadingP);
            return new Promise((resolve, reject) => {
                fetch(file).then(response => {
                if (response.status === 200) {
                    resolve(response);
                } else {
                    reject(`Error fetching '${file}'. Status: ${response.status}`);
                }
                })
            });
        }

        Promise
            .all([
                fetchJSON('orlando.json'),
                fetchJSON('las_vegas.json')
            ])
            .then(responses =>
                Promise.all(responses.map(res => res.json()))
            )
            .then(json => {
                DisplayTravelLog(json);
                console.log(json);
            })
            .catch((error) => {
                const errorP = document.createElement('p');
                const errorText = document.createTextNode(error);
                errorP.appendChild(errorText)
                main.innerHTML = '';
                main.appendChild(errorP);
                console.error(error);
            })
    </script>
</body>

</html>